# üõ†Ô∏è Guide JDBC + SQL pour Guacamole 1.6.0

## 1. Installer MySQL et cr√©er la base
sudo apt install mysql-server -y
sudo mysql

Dans MySQL :
CREATE DATABASE guacamole_db;
CREATE USER 'guacamole_user'@'localhost' IDENTIFIED BY 'motdepasse';
GRANT ALL PRIVILEGES ON guacamole_db.* TO 'guacamole_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

---

## 2. T√©l√©charger l‚Äôextension JDBC
cd /tmp
wget https://downloads.apache.org/guacamole/1.6.0/binary/guacamole-auth-jdbc-mysql-1.6.0.tar.gz
tar -xvzf guacamole-auth-jdbc-mysql-1.6.0.tar.gz

---

## 3. Importer les sch√©mas SQL
cd guacamole-auth-jdbc-mysql-1.6.0/mysql/schema
cat *.sql | mysql -u guacamole_user -p guacamole_db

üëâ V√©rifie ensuite :
mysql -u guacamole_user -p guacamole_db
SHOW TABLES;
Tu dois voir guacamole_user, guacamole_connection, etc.

---

## 4. D√©ployer le module JDBC
Copie le .jar dans le dossier des extensions :
sudo cp /tmp/guacamole-auth-jdbc-mysql-1.6.0.jar /etc/guacamole/extensions/

---

## 5. Configurer guacamole.properties
sudo nano /etc/guacamole/guacamole.properties :
guacd-hostname: localhost
guacd-port: 4822

mysql-hostname: localhost
mysql-port: 3306
mysql-database: guacamole_db
mysql-username: guacamole_user
mysql-password: motdepasse

auth-provider: net.sourceforge.guacamole.net.auth.mysql.MySQLAuthenticationProvider

---

## 6. D√©finir l‚Äôenvironnement Tomcat
sudo mkdir -p /etc/systemd/system/tomcat9.service.d
sudo nano /etc/systemd/system/tomcat9.service.d/guacamole.conf

Contenu :
[Service]
Environment=GUACAMOLE_HOME=/etc/guacamole

Recharge systemd :
sudo systemctl daemon-reexec
sudo systemctl restart tomcat9

---

## 7. Cr√©er un utilisateur Guacamole dans la base
‚ö†Ô∏è Ce n‚Äôest pas un compte MySQL, mais un compte **Guacamole** stock√© dans guacamole_user.

Exemple simple (mot de passe en clair pour tester) :
INSERT INTO guacamole_user (username, password_hash, password_salt, disabled, expired)
VALUES ('compteA', UNHEX(SHA2('compteA', 256)), NULL, 0, 0);

üëâ Tu pourras te connecter avec :
- **Utilisateur** : compteA
- **Mot de passe** : compteA

---

## 8. Red√©marrer les services
sudo systemctl restart guacd
sudo systemctl restart tomcat9

---

## 9. Connexion web
Acc√®de √† :
http://<IP_SERVEUR>:8080/guacamole
Connecte-toi avec l‚Äôutilisateur cr√©√© (compteA/compteA).

---

## ‚úÖ R√©sum√©
- Les identifiants MySQL (guacamole_user/motdepasse) servent uniquement √† Guacamole pour acc√©der √† la base.  
- Les **utilisateurs Guacamole** doivent √™tre cr√©√©s dans la table guacamole_user.  
- Tu peux tester avec un mot de passe en clair (`UNHEX(SHA2(...))`) puis passer ensuite √† une version s√©curis√©e avec **hash + salt**.
