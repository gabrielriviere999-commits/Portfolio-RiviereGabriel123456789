# üìò Documentation : Installation et Configuration d‚ÄôApache Guacamole avec JDBC sur Ubuntu 24.04 LTS

## 1. Installer Tomcat 9 manuellement

cd /tmp
wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.82/bin/apache-tomcat-9.0.82.tar.gz
tar -xvzf apache-tomcat-9.0.82.tar.gz
sudo mv apache-tomcat-9.0.82 /opt/tomcat9
sudo ln -s /opt/tomcat9 /opt/tomcat

### Cr√©er le service systemd :
sudo nano /etc/systemd/system/tomcat9.service
[Unit]
Description=Apache Tomcat 9
After=network.target

[Service]
Type=forking
Environment=JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
Environment=CATALINA_HOME=/opt/tomcat9
Environment=CATALINA_BASE=/opt/tomcat9
Environment=CATALINA_PID=/opt/tomcat9/tomcat.pid
ExecStart=/opt/tomcat9/bin/startup.sh
ExecStop=/opt/tomcat9/bin/shutdown.sh
User=www-data
Group=www-data
Restart=always

[Install]
WantedBy=multi-user.target

### Activer le service :
sudo chown -R www-data:www-data /opt/tomcat9
sudo chmod -R 755 /opt/tomcat9
sudo systemctl daemon-reexec
sudo systemctl enable tomcat9
sudo systemctl start tomcat9

---

## 2. Installer les d√©pendances Guacamole Server

sudo apt update
sudo apt install build-essential libcairo2-dev libjpeg-turbo8-dev libpng-dev \
libossp-uuid-dev libavcodec-dev libavutil-dev libswscale-dev freerdp2-dev \
libpango1.0-dev libssh2-1-dev libtelnet-dev libvncserver-dev libpulse-dev \
libssl-dev libvorbis-dev libwebp-dev openjdk-17-jdk -y

## 3. Compiler et installer Guacamole Server

cd /tmp
wget https://downloads.apache.org/guacamole/1.5.5/source/guacamole-server-1.5.5.tar.gz
tar -xvzf guacamole-server-1.5.5.tar.gz
cd guacamole-server-1.5.5
./configure
make
sudo make install
sudo ldconfig

### Cr√©er le service systemd pour guacd :
sudo nano /etc/systemd/system/guacd.service
[Unit]
Description=Guacamole proxy daemon (guacd)
After=network.target

[Service]
ExecStart=/usr/local/sbin/guacd -f
Restart=always
User=guacd
Group=guacd

[Install]
WantedBy=multi-user.target

### Activer le service :
sudo useradd -r -s /bin/false guacd   # si l‚Äôutilisateur n‚Äôexiste pas
sudo systemctl daemon-reexec
sudo systemctl enable guacd
sudo systemctl start guacd

---

## 4. D√©ploiement du client Guacamole
1. Supprimer les anciens fichiers :
sudo rm -rf /opt/tomcat9/webapps/guacamole*

2. T√©l√©charger le .war :
cd /tmp
wget https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-1.5.5.war

3. Copier dans Tomcat :
sudo cp /tmp/guacamole-1.5.5.war /opt/tomcat9/webapps/guacamole.war

4. Red√©marrer Tomcat :
sudo systemctl restart tomcat9

üëâ V√©rifier que le dossier /opt/tomcat9/webapps/guacamole/ est cr√©√© et que l‚Äôinterface est accessible via :
http://<IP_SERVEUR>:8080/guacamole/

---

## 5. Installation de MariaDB
sudo apt install mariadb-server
sudo systemctl enable --now mariadb
sudo mysql_secure_installation

### Cr√©ation de la base et de l‚Äôutilisateur
CREATE DATABASE guacadb;
CREATE USER 'guaca_nachos'@'localhost' IDENTIFIED BY 'TonMotDePasse';
GRANT SELECT,INSERT,UPDATE,DELETE ON guacadb.* TO 'guaca_nachos'@'localhost';
FLUSH PRIVILEGES;

---

## 6. Extension JDBC et Connecteur MySQL
### Cr√©er les dossiers :
sudo mkdir -p /etc/guacamole/extensions
sudo mkdir -p /etc/guacamole/lib

### T√©l√©charger et installer l‚Äôextension JDBC :
cd /tmp
wget https://downloads.apache.org/guacamole/1.5.5/binary/guacamole-auth-jdbc-1.5.5.tar.gz
tar -xzf guacamole-auth-jdbc-1.5.5.tar.gz
sudo cp guacamole-auth-jdbc-1.5.5/mysql/guacamole-auth-jdbc-mysql-1.5.5.jar /etc/guacamole/extensions/

### T√©l√©charger et installer le connecteur MySQL :
cd /tmp
wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-j-9.1.0.tar.gz
tar -xzf mysql-connector-j-9.1.0.tar.gz
sudo cp mysql-connector-j-9.1.0/mysql-connector-j-9.1.0.jar /etc/guacamole/lib/

---

## 7. Import du sch√©ma SQL
cd /tmp/guacamole-auth-jdbc-1.5.5/mysql/schema/
cat *.sql | sudo mysql guacadb

üëâ V√©rification :
USE guacadb;
SHOW TABLES;
Tu dois voir 23 tables (guacamole_user, guacamole_connection, etc.).

---

## 8. Configuration de Guacamole
sudo nano /etc/guacamole/guacamole.properties
mysql-hostname: 127.0.0.1
mysql-port: 3306
mysql-database: guacadb
mysql-username: guaca_nachos
mysql-password: TonMotDePasse

### D√©finir GUACAMOLE_HOME
sudo mkdir -p /etc/systemd/system/tomcat9.service.d
sudo nano /etc/systemd/system/tomcat9.service.d/guacamole.conf
[Service]
Environment=GUACAMOLE_HOME=/etc/guacamole

---

## 9. Red√©marrage des services
sudo systemctl daemon-reexec
sudo systemctl restart tomcat9
sudo systemctl restart guacd mariadb

---

## 10. Connexion par d√©faut
Acc√©der √† :
http://<IP_SERVEUR>:8080/guacamole/

Identifiants initiaux :  
- Login : guacadmin
- Mot de passe : guacadmin 

‚ö†Ô∏è Change imm√©diatement ce mot de passe apr√®s la premi√®re connexion.

---

## 11. √âtapes post-installation
- Cr√©er tes propres utilisateurs.
- Ajouter des connexions RDP/SSH/VNC via l‚Äôinterface web.
- (Optionnel) Configurer un reverse proxy Nginx/Apache pour HTTPS.
